1Ô∏è‚É£ Qu‚Äôest-ce que le RBAC ? (Why, What, Where, How)

RBAC est un m√©canisme de contr√¥le d‚Äôacc√®s bas√© sur les r√¥les dans Kubernetes. Il permet de d√©finir qui peut faire quoi sur quelles ressources.

Why (Pourquoi) : S√©curiser un cluster Kubernetes en donnant le minimum de permissions n√©cessaires √† chaque entit√© (principe du moindre privil√®ge).

What (Quoi) : Des objets Kubernetes qui d√©crivent les r√¥les et liaisons.

Where (O√π) : Dans le cluster Kubernetes, via l‚ÄôAPI server. Les r√®gles peuvent √™tre namespace-scoped ou cluster-wide.

How (Comment) : On cr√©e des Roles/ClusterRoles et on les attache √† des Users/ServiceAccounts/Groups via des RoleBindings/ClusterRoleBindings.

2Ô∏è‚É£ Diff√©rence entre Users et ServiceAccounts
Type	Description	Usage typique
User	Identit√© externe (ex: d√©veloppeur, administrateur)	Connexion via kubeconfig, OIDC, IAM
ServiceAccount	Identit√© interne au cluster pour des pods/applications	Pods qui doivent acc√©der √† l‚ÄôAPI Kubernetes (ex: d√©ploiement CI/CD, controllers)

Note : On ne cr√©e pas de User via Kubernetes, il vient d‚Äôun provider externe. Par contre, ServiceAccount est un objet Kubernetes.

3Ô∏è‚É£ Les r√¥les : Role et ClusterRole

Role : permissions limit√©e √† un namespace.

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: dev
  name: pod-reader
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list", "watch"]

ClusterRole : permissions √† l‚Äô√©chelle du cluster ou r√©utilisable dans plusieurs namespaces.

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-admin
rules:
  - apiGroups: ["*"]
    resources: ["*"]
    verbs: ["*"]

üí° Astuce : un ClusterRole peut √™tre attach√© √† un namespace sp√©cifique via un RoleBinding.

4Ô∏è‚É£ Les liaisons : RoleBinding et ClusterRoleBinding

Ces objets attachent un r√¥le √† un utilisateur, un groupe ou un service account.

RoleBinding : lie un Role ou ClusterRole √† un sujet dans un namespace pr√©cis.

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: dev
subjects:
  - kind: User
    name: alice
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

ClusterRoleBinding : lie un ClusterRole √† un sujet cluster-wide.

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-binding
subjects:
  - kind: User
    name: bob
    apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
5Ô∏è‚É£ Gestion des permissions par namespace ou cluster-wide

Namespace-scoped : via Role + RoleBinding

Limite l‚Äôacc√®s aux ressources d‚Äôun namespace sp√©cifique.

Cluster-wide : via ClusterRole + ClusterRoleBinding

Donne acc√®s √† toutes les ressources du cluster, ou √† certaines ressources globales (ex: nodes, storage classes).

‚ö†Ô∏è Pratique recommand√©e : privil√©gier Role + RoleBinding pour limiter la surface d‚Äôattaque.

6Ô∏è‚É£ Comment lier les utilisateurs aux r√¥les (OIDC, IAM, etc.)

Kubernetes ne g√®re pas directement les comptes utilisateurs. Il s‚Äôappuie sur des providers externes :

Provider	Comment √ßa marche
OIDC	Les tokens JWT d‚Äôun identity provider (ex: Keycloak, Azure AD, Google) sont v√©rifi√©s par l‚ÄôAPI server.
IAM (AWS)	Avec aws-iam-authenticator, on mappe des r√¥les IAM aux users Kubernetes via ConfigMap aws-auth.
kubeconfig static	On d√©finit un utilisateur dans le kubeconfig avec certs ou tokens.

Ensuite, on attache ces utilisateurs √† des RoleBinding ou ClusterRoleBinding.

‚úÖ En r√©sum√© :

RBAC = contr√¥le d‚Äôacc√®s bas√© sur les r√¥les.

User = externe, ServiceAccount = interne au cluster.

Role = namespace, ClusterRole = cluster.

RoleBinding = namespace, ClusterRoleBinding = cluster.

Permissions peuvent √™tre limit√©es ou cluster-wide.

Liaison des utilisateurs se fait via des providers externes (OIDC, IAM, kubeconfig).
